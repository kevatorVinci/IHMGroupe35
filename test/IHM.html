<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan du projet - Vinci Arena (Final)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* --- Styles globaux --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Roboto', sans-serif; background-color: #f1f5f9; color: #334155; padding: 40px; padding-bottom: 80px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 32px; color: #0f172a; margin-bottom: 10px; }
        .header p { color: #64748b; font-size: 16px; margin-bottom: 25px; }

        .category-block { background: #fff; border-radius: 12px; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 5px solid #2563eb; }
        .category-title { font-size: 20px; font-weight: 700; color: #0f172a; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        .ihm-list { list-style: none; display: flex; flex-direction: column; gap: 10px; }
        .ihm-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0; }
        .ihm-item a { text-decoration: none; color: #334155; font-weight: 500; flex-grow: 1; display: flex; align-items: center; gap: 10px; }
        .ihm-item a:hover { color: #2563eb; }
        
        .badge-group { display: flex; gap: 10px; align-items: center; }

        .badge { 
            padding: 6px 10px; border-radius: 4px; font-size: 11px; font-weight: 700; 
            text-transform: uppercase; cursor: pointer; user-select: none; transition: 0.2s; min-width: 85px; text-align: center;
        }
        .badge:hover { filter: brightness(0.95); transform: scale(1.05); }
        .badge-done { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .badge-todo { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }

        /* --- Bouton Capture --- */
        .btn-capture {
            background: #cbd5e1; color: #0f172a; border: none; padding: 6px 10px; border-radius: 4px;
            font-size: 12px; font-weight: 700; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .btn-capture:hover { background: #112b4f; color: white; transform: scale(1.05); }

        #save-btn-container { position: fixed; bottom: 30px; right: 30px; display: none; z-index: 1000; animation: slideIn 0.3s ease-out; }
        .btn-save { background-color: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 50px; font-weight: 700; font-size: 14px; cursor: pointer; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4); display: flex; align-items: center; gap: 10px; }
        .btn-import { background-color: #10b981; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 15px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-import:hover { background-color: #059669; transform: translateY(-2px); }

        /* Overlay de chargement pour la capture */
        #loading-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(17, 43, 79, 0.8); color: white; z-index: 9999;
            justify-content: center; align-items: center; flex-direction: column; font-size: 20px; font-weight: bold;
        }

        @keyframes slideIn { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div id="loading-overlay">ğŸ“¸ Capture en cours... Fixation des images...</div>

<div class="container">
    <div class="header">
        <h1>ğŸ® Vinci Arena : Plan de DÃ©veloppement</h1>
        <p>SÃ©quenÃ§age logique des interfaces par RÃ´les et AccÃ¨s</p>
        
        <button class="btn-import" onclick="importerDonnees()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
            Recharger les statuts (JSON)
        </button>
    </div>

    <div class="category-block" style="border-left-color: #64748b;">
        <h2 class="category-title">ğŸŒ 1. AccÃ¨s Public</h2>
        <ul class="ihm-list">
            <li class="ihm-item"><a href="accueil.html"><span>IHM 1</span> Accueil (Visiteur/ConnectÃ©)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('accueil.html', 'IHM_1_Accueil')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="connexion.html"><span>IHM 2</span> Connexion</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('connexion.html', 'IHM_2_Connexion')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="inscription.html"><span>IHM 3</span> Inscription</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('inscription.html', 'IHM_3_Inscription')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="equipes_publique.html"><span>IHM 4</span> Annuaire des membres (Public)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('equipes_publique.html', 'IHM_4_Annuaire')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="equipes_publique.html"><span>IHM 5</span> Liste de toutes les Ã©quipes</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('equipes_publique.html', 'IHM_5_ListeEquipes')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="liste_tournois.html"><span>IHM 6</span> Liste des tournois</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('liste_tournois.html', 'IHM_6_ListeTournois')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="detailsTournoi.html"><span>IHM 7</span> DÃ©tail dâ€™un tournoi</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('detailsTournoi.html', 'IHM_7_DetailTournoi')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="details_equipe.html"><span>IHM 8</span> Details equipe</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('details_equipe.html', 'IHM_8_DetailEquipe')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
        </ul>
    </div>

    <div class="category-block" style="border-left-color: #2563eb;">
        <h2 class="category-title">ğŸ‘¤ 2. Espace Membre (ConnectÃ©)</h2>
        <ul class="ihm-list">
            <li class="ihm-item"><a href="tableauDeborSansEquipe.html"><span>IHM 10</span> Dashboard (Sans Ã©quipe)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('tableauDeborSansEquipe.html', 'IHM_10_Dash_SansEquipe')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="tableauDeborEquipe.html"><span>IHM 11</span> Dashboard (Avec Ã©quipe)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('tableauDeborEquipe.html', 'IHM_11_Dash_Equipe')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="profil.html"><span>IHM 12</span> Mon Profil (Vue)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('profil.html', 'IHM_12_Profil')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="edtiProfil.html"><span>IHM 13</span> Ã‰dition de profil</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('edtiProfil.html', 'IHM_13_EditProfil')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="disponibilite.html"><span>IHM 14</span> Gestion des indisponibilitÃ©s</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('disponibilite.html', 'IHM_14_Dispo')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="monActivite.html"><span>IHM 15</span> Historique "Mon activitÃ©"</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('monActivite.html', 'IHM_15_Activite')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="notifications.html"><span>IHM 16</span> Centre de notifications</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('notifications.html', 'IHM_16_Notifs')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="rejoindre_equipe.html"><span>IHM 17</span> Rejoindre une Ã©quipe</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('rejoindre_equipe.html', 'IHM_17_Rejoindre')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="creer_equipe.html"><span>IHM 18</span> CrÃ©er une Ã©quipe</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('creer_equipe.html', 'IHM_18_CreerEquipe')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="detailsmatch_membre.html"><span>IHM 9</span> DÃ©tail dâ€™un match (Vue Membre)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('detailsmatch_membre.html', 'IHM_9_DetailMatch')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
        </ul>
    </div>

    <div class="category-block" style="border-left-color: #f59e0b;">
        <h2 class="category-title">ğŸ›¡ï¸ 3. Gestion d'Ã‰quipe (Responsable)</h2>
        <ul class="ihm-list">
            <li class="ihm-item"><a href="equipesVueAdmin.html"><span>IHM 19</span> Mon Ã©quipe (Vue Responsable)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('equipesVueAdmin.html', 'IHM_19_EquipeResp')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="equipesVueMembre.html"><span>IHM 20</span> Mon Ã©quipe (Vue Membre)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('equipesVueMembre.html', 'IHM_20_EquipeMembre')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="gestion_adhesions.html"><span>IHM 21</span> Demandes dâ€™adhÃ©sion</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('gestion_adhesions.html', 'IHM_21_Adhesions')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="match_a_venir.html"><span>IHM 22</span> Liste des matchs de la team</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('match_a_venir.html', 'IHM_22_ListeMatchs')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="selection_match.html"><span>IHM 23</span> SÃ©lection des joueurs (4/4)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('selection_match.html', 'IHM_23_Selection')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="detail_match.html"><span>IHM 24</span> DÃ©tail match (Vue Responsable et Membre)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('detail_match.html', 'IHM_24_DetailMatchComplet')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="resultat_responsable.html"><span>IHM 25</span> Valider / Contester rÃ©sultat</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('resultat_responsable.html', 'IHM_25_Validation')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
        </ul>
    </div>

    <div class="category-block" style="border-left-color: #dc2626;">
        <h2 class="category-title">ğŸ‘‘ 4. Administration Globale (Admin)</h2>
        <ul class="ihm-list">
            <li class="ihm-item"><a href="gestionTournoiAdmin.html"><span>IHM 27</span> Dashboard Gestion Tournois</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('gestionTournoiAdmin.html', 'IHM_27_DashAdmin')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="gestionAdmin.html"><span>IHM 28</span> Gestion des Administrateurs</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('gestionAdmin.html', 'IHM_28_GestionAdmins')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="creer_tournoi.html"><span>IHM 29</span> CrÃ©er un tournoi</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('creer_tournoi.html', 'IHM_29_CreerTournoi')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="detail_tournoi_admin.html"><span>IHM 31</span> DÃ©tail tournoi (Vue Admin)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('detail_tournoi_admin.html', 'IHM_31_DetailTournoiAdmin')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="generation_planning.html"><span>IHM 33</span> GÃ©nÃ©ration du planning</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('generation_planning.html', 'IHM_33_GenPlanning')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="edition_planning.html"><span>IHM 34</span> Ã‰dition manuelle planning</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('edition_planning.html', 'IHM_34_EditPlanning')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="encodage.html"><span>IHM 35</span> Saisie du rÃ©sultat officiel</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('detail_match.html', 'IHM_35_SaisieResultat')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="detail_match_admin.html"><span>IHM 36</span> DÃ©tails match (Vue Admin)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('detail_match_admin.html', 'IHM_36_DetailMatchAdmin')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
        </ul>
    </div>

    <div class="category-block" style="border-left-color: #10b981;">
        <h2 class="category-title">ğŸ—ï¸ 5. Navigation Dynamique (IHM 36-40)</h2>
        <ul class="ihm-list">
            <li class="ihm-item"><a href="accueil.html"><span>IHM 36</span> Header Visiteur</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('accueil.html', 'IHM_36_HeaderVisiteur', '.navbar')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="tableauDeborSansEquipe.html"><span>IHM 37</span> Header Membre (Sans Ã©quipe)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('tableauDeborSansEquipe.html', 'IHM_37_HeaderMembre', '.navbar')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="tableauDeborEquipe.html"><span>IHM 38</span> Header Membre / Responsable (Avec Ã©quipe)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('tableauDeborEquipe.html', 'IHM_38_HeaderResp', '.navbar')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="headerAdmin.html"><span>IHM 39</span> Header Administrateur Global</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('headerAdmin.html', 'IHM_39_HeaderAdminGlobal', '.navbar')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
            <li class="ihm-item"><a href="gestionAdmin.html"><span>IHM 40</span> Header Admin (Vue Gestion interne)</a> <div class="badge-group"><button class="btn-capture" onclick="takeScreenshot('gestionAdmin.html', 'IHM_40_HeaderGestionAdmin', '.navbar')">ğŸ“¸ PNG</button><span class="badge badge-todo" onclick="toggleStatus(this)">Ã€ faire</span></div></li>
        </ul>
    </div>
</div>

<div id="save-btn-container">
    <button class="btn-save" onclick="exporterDonnees()">ğŸ’¾ Sauvegarder les changements</button>
</div>

<script>
    const STORAGE_KEY = 'ihm_statuts';
    let hasUnsavedChanges = false;
    
    document.addEventListener('DOMContentLoaded', chargerStatuts);

    function toggleStatus(badge) {
        if (badge.classList.contains('badge-todo')) {
            badge.classList.replace('badge-todo', 'badge-done');
            badge.innerText = 'Fait';
        } else {
            badge.classList.replace('badge-done', 'badge-todo');
            badge.innerText = 'Ã€ faire';
        }
        hasUnsavedChanges = true;
        document.getElementById('save-btn-container').style.display = 'block';
    }

    function exporterDonnees() {
        const statuts = {};
        document.querySelectorAll('.ihm-item').forEach(item => {
            const ihmName = item.querySelector('span').innerText;
            const badge = item.querySelector('.badge');
            statuts[ihmName] = badge.classList.contains('badge-done') ? 'fait' : 'todo';
        });
        
        const data = { lastUpdate: new Date().toISOString(), statuts: statuts };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        const blob = new Blob([JSON.stringify(data, null, 4)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'ihm_status.json'; a.click();
        document.getElementById('save-btn-container').style.display = 'none';
        hasUnsavedChanges = false;
        alert('âœ… Statuts sauvegardÃ©s !');
    }

    function chargerStatuts() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) appliquerDonnees(JSON.parse(saved));
    }

    function appliquerDonnees(data) {
        document.querySelectorAll('.ihm-item').forEach(item => {
            const ihmName = item.querySelector('span').innerText;
            const badge = item.querySelector('.badge');
            if (data.statuts && data.statuts[ihmName]) {
                const isDone = data.statuts[ihmName] === 'fait';
                badge.className = `badge ${isDone ? 'badge-done' : 'badge-todo'}`;
                badge.innerText = isDone ? 'Fait' : 'Ã€ faire';
            }
        });
    }

    function importerDonnees() {
        fetch('data/ihm_status.json')
            .then(res => res.json())
            .then(data => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                appliquerDonnees(data);
                alert('âœ… Statuts rechargÃ©s !');
            })
            .catch(() => alert('âš ï¸ Fichier JSON non trouvÃ©.'));
    }

    // --- FONCTION DE CAPTURE AVEC FIX POUR LES IMAGES EXTERNES ---
    async function takeScreenshot(url, fileName, selector = 'body') {
        const overlay = document.getElementById('loading-overlay');
        overlay.style.display = 'flex';

        try {
            // 1. CrÃ©er une iframe invisible
            const iframe = document.createElement('iframe');
            iframe.style.width = '1280px'; 
            iframe.style.height = '1080px';
            iframe.style.position = 'fixed';
            iframe.style.top = '-10000px'; 
            iframe.style.visibility = 'hidden';
            iframe.src = url;
            document.body.appendChild(iframe);

            // 2. Attendre que la page charge dans l'iframe
            await new Promise(resolve => {
                iframe.onload = () => {
                    setTimeout(resolve, 800); // Laisse un peu de temps Ã  la page pour s'afficher
                };
            });

            const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;

            // 3. SUPER HACK : Convertir toutes les images externes en code "Base64"
            // Cela empÃªche le navigateur de bloquer html2canvas Ã  cause de la sÃ©curitÃ© CORS
            const images = iframeDocument.querySelectorAll('img');
            for (let img of images) {
                if (img.src && img.src.includes('http')) {
                    try {
                        const res = await fetch(img.src);
                        const blob = await res.blob();
                        const base64data = await new Promise(resolve => {
                            const reader = new FileReader();
                            reader.onloadend = () => resolve(reader.result);
                            reader.readAsDataURL(blob);
                        });
                        img.src = base64data;
                    } catch(err) {
                        console.warn("Impossible de forcer le rendu de cette image :", img.src);
                    }
                }
            }

            // 4. DÃ©terminer quel Ã©lÃ©ment capturer
            const targetElement = iframeDocument.querySelector(selector);
            if (!targetElement) {
                console.warn(`SÃ©lecteur "${selector}" introuvable, capture de la page entiÃ¨re Ã  la place.`);
            }
            const elementToCapture = targetElement || iframeDocument.body;

            // 5. Capturer avec html2canvas (sans allowTaint car on a dÃ©jÃ  gÃ©rÃ© les images !)
            const canvas = await html2canvas(elementToCapture, {
                useCORS: true, 
                scale: 1, 
                backgroundColor: null // Garde la transparence
            });

            // 6. TÃ©lÃ©charger le PNG
            const link = document.createElement('a');
            link.download = fileName + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();

            // 7. Nettoyer
            document.body.removeChild(iframe);

        } catch (error) {
            console.error(error);
            alert("âŒ Erreur lors de la capture. VÃ©rifiez que la page existe et que le serveur local est actif.");
        } finally {
            overlay.style.display = 'none';
        }
    }
</script>

</body>
</html>